generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

// Home Assistant Secrets
model Secret {
  id        String    @id
  reference String?
  itemId    String?   @map("item_id")
  updatedAt DateTime? @updatedAt @map("updated_at")
  isSkipped Boolean?  @default(false) @map("is_skipped")

  item   Item?         @relation(fields: [itemId], references: [id], onDelete: SetNull)
  groups SecretGroup[]

  @@map("ha_secrets")
}

// Secret Groups for HA event notifications
model Group {
  id          String   @id @default(uuid())
  name        String   @unique // lowercase alphanumeric, underscores, hyphens only
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  secrets SecretGroup[]

  @@map("groups")
}

// Junction table for many-to-many Secret <-> Group
model SecretGroup {
  secretId String   @map("secret_id")
  groupId  String   @map("group_id")
  addedAt  DateTime @default(now()) @map("added_at")

  secret Secret @relation(fields: [secretId], references: [id], onDelete: Cascade)
  group  Group  @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@id([secretId, groupId])
  @@map("secret_groups")
}

// 1Password Item
model Item {
  id             String   @id
  title          String
  vaultId        String?  @map("vault_id")
  category       String
  additionalInfo String?  @map("additional_information")
  createdAt      DateTime @map("created_at")
  updatedAt      DateTime @map("updated_at")
  urls           String? // JSON
  fields         String? // JSON

  vault  Vault?   @relation(fields: [vaultId], references: [id], onDelete: SetNull)
  secret Secret[]

  @@map("op_items")
}

// 1Password Vault
model Vault {
  id   String @id
  name String

  items Item[]

  @@map("op_vaults")
}

model Setting {
  id        String   @id
  value     String
  updatedAt DateTime @default(now()) @map("updated_at")

  @@map("settings")
}
